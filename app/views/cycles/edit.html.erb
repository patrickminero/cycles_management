<div class="w-6/12 mx-auto flex py-20 justify-center">
  <div class="w-full h-auto">
    <h1 class="text-sans text-3xl text-indigo-900 mb-5">Edit <%= @cycle.name %> cycle</h1>
    <%= form_with(cycle: @cycle, local: true, method: 'patch', url: cycle_path) do |form| %>
      <% if @cycle.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@cycle.errors.count, "error") %> prohibited this cycle from being saved:</h2>
          <ul>
            <% @cycle.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      <%= form.label :name, "Name", class: 'text-lg mb-4' %>
      <%= form.text_field :name, class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: @cycle.name %>
      <h1 class="text-3xl mb-4">Components</h1>
      <% @cycle.components.each_with_index do |comp, index| %>
        <% if comp.keys[1] == 'impacts' %>
        <div class="border-2 border-indigo-900 rounded py-3 px-4 mb-5">
          <div class="field">
            <%= form.label 'cycle[:components_name]', "Component name", class: 'text-lg mb-4' %>
            <div class="flex justify-between">
              <%= form.text_field 'cycle[component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: comp["name"] %>
            </div>
          </div>
          <div class="field">
            <%= form.label 'cycle[:components]', "Impacts", class: 'text-lg mb-1' %>
            <div class="ml-3">
              <%= form.label 'cycle[climate_change]', "Climate chage", class: 'text-lg mb-4' %>
              <%= form.number_field 'cycle[climate_change]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: comp["impacts"]["climate_change"] %>
              <%= form.label 'cycle[water_use]', "Water use", class: 'text-lg mb-4' %>
              <%= form.number_field 'cycle[water_use]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: comp["impacts"]["water_use"] %>
            </div>
          </div>
          <div class="text-right my-6">
            <%= link_to 'Update component', update_component_path(@cycle, index, comp), method: 'patch', class: 'rounded border-2 border-red-800 bg-white-800 hover:bg-red-500 py-2 px-4 text-red-800' %>
            <%= link_to 'Delete component', delete_component_path(@cycle, index, comp), method: 'delete', class: 'rounded bg-red-800 hover:bg-red-500 py-2 px-4 text-white' %>
          </div>
        </div>
        <% elsif comp.keys[1] == 'components' %>
          <div class="border-2 border-indigo-900 rounded py-2 px-4 mb-5">
            
            <div>
              <%= form.label 'cycle[components_name]', "Components name", class: 'text-lg mb-4' %>
              <%= form.text_field 'cycle[component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: comp["name"] %>
            </div>
  
            <div class="ml-5">
              <% comp["components"].each_with_index do |sub, ind| %>
                <%= form.label 'cycle[impacts][component_name]', "Subcomponent name", class: 'text-lg mb-4' %>
                <%= form.text_field 'cycle[impacts][component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: sub["name"] %>
                <%= form.label 'cycle[:components]', "Impacts", class: 'text-lg mb-1' %>
                <div class="ml-7 border-2 border-indigo-900 rounded py-2 px-4">
                  <%= form.label 'cycle[impacts][climate_change]', "Climate change", class: 'text-lg mb-1' %>
                  <%= form.number_field 'cycle[impacts][climate_change]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: sub["impacts"]["climate_change"] %>
                  <%= form.label 'cycle[impacts][water_use]', "Water use", class: 'text-lg mb-1' %>
                  <%= form.number_field 'cycle[impacts][water_use]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: sub["impacts"]["water_use"] %>
                  <div class="my-6">
                    <%= link_to 'Update subcomponent', delete_subcomponent_path({subindex: ind, index: index, component: sub}), method: 'delete', class: 'rounded bg-white border-2 border-red-800 hover:bg-red-500 py-2 px-4 text-red-800' %>
                    <%= link_to 'Delete subcomponent', delete_subcomponent_path({subindex: ind, index: index, component: sub}), method: 'delete', class: 'rounded bg-red-800 hover:bg-red-500 py-2 px-4 text-white' %>
                  </div>
                </div>
                
              <% end %>
            </div>
            <div class="text-right my-6">
              <%= link_to 'Update component', delete_component_path(@cycle, index, comp), method: 'patch', class: 'rounded border-2 border-red-800 bg-white-800 hover:bg-red-500 py-2 px-4 text-red-800' %>
              <%= link_to 'Delete component', delete_component_path(@cycle, index, comp), method: 'delete', class: 'rounded bg-red-800 hover:bg-red-500 py-2 px-4 text-white' %>
            </div>
          </div>
        <% end %>
      <% end %>

      <div class="actions mb-5">
        <%= link_to 'Add Components', new_component_path(@cycle), class: 'rounded bg-indigo-900 hover:bg-blue-700 py-4 px-4 text-white visited:text-white' %>
        <%= link_to "Go to #{@cycle.name} page", cycle_path(@cycle), class: "rounded bg-indigo-900 hover:bg-blue-700 py-4 px-4 text-white visited:text-white" %>
      </div>
    <% end %>
  </div>
</div>


