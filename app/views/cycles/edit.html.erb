<div class="h-screen w-6/12 mx-auto flex pt-28 justify-center">
  <div class="w-full h-auto">
    <h1 class="text-sans text-3xl text-indigo-900"><%= @cycle.name %></h1>
    <%= form_with(cycle: @cycle, local: true) do |form| %>
      <% if @cycle.errors.any? %>
        <div id="error_explanation">
          <h2><%= pluralize(@cycle.errors.count, "error") %> prohibited this cycle from being saved:</h2>

          <ul>
            <% @cycle.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>
      
      <%= form.text_field :name, class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: @cycle.name %>

      <h1 class="text-3xl mb-4">Components</h1>
      <% @cycle.components.each_with_index do |comp, index| %>
        <% if comp.keys[1] == 'impacts' %>
        <div class="field">
          <%= form.label 'cycle[:components_name]', "Component", class: 'text-lg mb-4' %>
          <div class="flex justify-between">
            <%= form.text_field 'cycle[component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: comp["name"] %>
            <%= link_to 'Delete component', delete_component_path(@cycle, index, comp), method: 'delete', class: 'rounded bg-indigo-900 hover:bg-blue-700 py-2 px-4 text-white' %>
          </div>
        </div>
        <div class="field">
          <%= form.label 'cycle[:components]', "Impacts", class: 'text-lg mb-4' %>
          <%= form.number_field 'cycle[climate_change]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: comp["impacts"]["climate_change"] %>
          <%= form.number_field 'cycle[water_use]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: comp["impacts"]["water_use"] %>
        </div>
        <% elsif comp.keys[1] == 'components' %>
          <%= form.label 'cycle[:components_name]', "Components", class: 'text-lg mb-4' %>
          <div class="flex justify-between">
            <%= form.text_field 'cycle[component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: comp["name"] %>
            <%= link_to 'Delete component', delete_component_path(@cycle, index, comp), method: 'delete', class: 'rounded bg-indigo-900 hover:bg-blue-700 py-2 px-4 text-white' %>
          </div>
          <div class="ml-5">
            <% comp["components"].each_with_index do |sub, ind| %>
              
                <%= form.label 'cycle["impacts"]["component_name"]', "Component", class: 'text-lg mb-4' %>
                <div class="flex justify-between">
                  <%= form.text_field 'cycle["impacts"][component_name]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full", autofocus: true, value: sub["name"] %>
                  <%= link_to 'Delete subcomponent', delete_subcomponent_path({subindex: ind, index: index, component: sub["name"]}), method: 'delete', class: 'rounded bg-indigo-600 hover:bg-blue-700 py-2 px-4 text-white' %>
                </div>
              <%= form.label 'cycle[:components]', "Impacts", class: 'text-lg mb-4' %>
              <%= form.number_field 'cycle["impacts"][climate_change]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: sub["impacts"]["climate_change"] %>
              <%= form.number_field 'cycle["impacts"][water_use]', class: "p-16 bg-white focus:outline-none focus:shadow-outline border border-gray-500 rounded-md py-2 px-2 block appearance-none leading-normal w-full mb-2", autofocus: true, value: sub["impacts"]["water_use"] %>
            <% end %>
          </div>
        <% end %>
      <% end %>

      <div class="actions">
        <%= link_to 'Update Cycle', edit_cycle_path(@cycle), class: 'rounded bg-indigo-900 hover:bg-blue-700 py-2 px-4 text-white' %>
        <%= link_to 'Add Components', new_component_path(@cycle), class: 'rounded bg-indigo-900 hover:bg-blue-700 py-2 px-4 text-white' %>
      </div>
    <% end %>
  </div>
</div>


